---
import BaseLayout from "../layouts/BaseLayout.astro";
import site from "../data/site.json";
import HeroPro from "../components/HeroPro.astro";
import SectionHeader from "../components/SectionHeader.astro";
import Applications from "../components/Applications.astro";
import Problems from "../components/Problems.astro";
import Strengths from "../components/Strengths.astro";
import EcosystemFlow from "../components/EcosystemFlow.astro";
import TokenomicsChart from "../components/TokenomicsChart.astro";
import TokenDetails from "../components/TokenDetails.astro";
import Marquee from "../components/Marquee.astro";

const ieoStart = site.ieo?.start ? new Date(site.ieo.start).toISOString() : null;
---
<BaseLayout title={`${site.siteName} — ${site.tagline}`} description={site.description}>
  <HeroPro site={site} />

  <section class="section">
    <div class="container">
      <Marquee items={site.partners} />
    </div>
  </section>

  <section id="overview" class="section">
    <div class="container grid grid-2">
      <div>
        <SectionHeader eyebrow="Overview" title={site.intro.headline} sub={site.intro.copy} />
        <ul class="reveal">
          {site.token.utilities.map((u) => (<li>• {u}</li>))}
        </ul>
        <div class="reveal" style="margin-top:14px; display:flex; gap:12px; flex-wrap:wrap;">
          <a class="btn ghost" href={site.links.docs}>Docs</a>
          <a class="btn ghost" href={site.links.github}>GitHub</a>
        </div>
      </div>
      <div class="panel reveal">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
          <div><span class="eyebrow">IEO Countdown</span><h3 style="margin:6px 0 0">上場まで</h3></div>
          <span class="pill">{site.ieo.exchange || 'TBA'}</span>
        </div>
        {ieoStart ? (
          <>
            <div id="countdown" data-date={ieoStart} style="display:flex; gap:12px; margin-top:12px;">
              <div class="card" style="text-align:center; flex:1"><div style="font-size:28px; font-weight:800" id="d">-</div><div class="muted">日</div></div>
              <div class="card" style="text-align:center; flex:1"><div style="font-size:28px; font-weight:800" id="h">-</div><div class="muted">時間</div></div>
              <div class="card" style="text-align:center; flex:1"><div style="font-size:28px; font-weight:800" id="m">-</div><div class="muted">分</div></div>
              <div class="card" style="text-align:center; flex:1"><div style="font-size:28px; font-weight:800" id="s">-</div><div class="muted">秒</div></div>
            </div>
            <div class="muted" style="margin-top:12px">開始日時: {new Date(site.ieo.start).toLocaleString('ja-JP', { timeZone: 'UTC' })} (UTC)</div>
          </>
        ) : (
          <div class="muted" style="margin-top:12px">IEO準備中</div>
        )}
      </div>
    </div>
    <script is:inline>
      const el = document.getElementById('countdown');
      if (el) {
        const target = new Date(el.dataset.date).getTime();
        const d = el.querySelector('#d');
        const h = el.querySelector('#h');
        const m = el.querySelector('#m');
        const s = el.querySelector('#s');
        function tick(){
          const now = Date.now();
          let diff = Math.max(0, target - now);
          const days = Math.floor(diff / (1000*60*60*24)); diff -= days*(1000*60*60*24);
          const hours = Math.floor(diff / (1000*60*60)); diff -= hours*(1000*60*60);
          const mins = Math.floor(diff / (1000*60)); diff -= mins*(1000*60);
          const secs = Math.floor(diff / 1000);
          d.textContent = String(days);
          h.textContent = String(hours).padStart(2,'0');
          m.textContent = String(mins).padStart(2,'0');
          s.textContent = String(secs).padStart(2,'0');
        }
        tick(); setInterval(tick, 1000);
      }
    </script>
  </section>

  <section id="applications" class="section">
    <div class="container">
      <SectionHeader eyebrow="Applications" title="応用分野" sub="マザーベジタブルの産業応用" />
      <Applications items={site.applications} />
    </div>
  </section>

  <section id="problems" class="section">
    <div class="container">
      <SectionHeader eyebrow="Problems & Solutions" title="解決したい課題とアプローチ" />
      <Problems categories={site.problems} />
    </div>
  </section>

  <section id="strengths" class="section">
    <div class="container">
      <SectionHeader eyebrow="Advantages" title="本プロジェクトの優位性" />
      <Strengths points={site.strengths} />
    </div>
  </section>

  <section id="ecosystem" class="section">
    <div class="container">
      <SectionHeader eyebrow="Ecosystem" title="循環する価値設計" />
      <EcosystemFlow flow={site.ecosystem} />
    </div>
  </section>

  <section id="sustainability" class="section">
    <div class="container grid grid-2">
      <div>
        <span class="eyebrow">Sustainability</span>
        <h2>自然に「プラス」の連鎖を生むデザイン</h2>
        <p class="muted">チェーンの成長が、そのまま地球の回復へと繋がる設計。透明性のあるオンチェーン会計で、どれだけ自然に還元されたかがリアルタイムに追跡できます。</p>
      </div>
      <div class="card">
        <ul>
          {site.sustainability.map((s) => (<li>• {s}</li>))}
        </ul>
      </div>
    </div>
  </section>

  <section id="token" class="section">
    <div class="container">
      <span class="eyebrow">Token</span>
      <h2>{site.token.symbol} 概要と配分</h2>
      <div class="grid grid-2">
        <TokenDetails details={[
          {label:'トークン', value: site.token.symbol},
          {label:'総供給', value: site.token.totalSupply},
          {label:'ネットワーク', value: site.token.network},
          {label:'コントラクト', value: site.token.contract || 'TBA'}
        ]} lockup={site.lockup} burn={site.burn} />
        <div class="card">
          <TokenomicsChart data={site.tokenomics} />
        </div>
      </div>
      <div class="panel reveal" style="margin-top:18px">
        <strong>資金使途</strong>
        <div style="margin-top:12px">
          <TokenomicsChart data={site.useOfProceeds} />
        </div>
      </div>
    </div>
  </section>

  <section id="ieo" class="section">
    <div class="container grid grid-2">
      <div>
        <span class="eyebrow">IEO</span>
        <h2>上場情報</h2>
        <p class="muted">取引所: <strong>{site.ieo.exchange || 'TBA'}</strong><br/>
          予定価格: <strong>{typeof site.ieo.priceUSD === 'number' ? `$${site.ieo.priceUSD.toFixed(3)}/${site.token.symbol}` : 'TBA'}</strong><br/>
          ハードキャップ: <strong>{typeof site.ieo.hardCapUSD === 'number' ? `$${site.ieo.hardCapUSD.toLocaleString()}` : 'TBA'}</strong><br/>
          割当: <strong>{site.ieo.allocation || 'TBA'}</strong>
        </p>
      </div>
      <div class="card">
        <ol>
          {site.ieo.howTo.map((s) => (<li>{s}</li>))}
        </ol>
        <div style="margin-top:14px">
          <a class="btn primary" href="#cta">{site.cta.primary}</a>
        </div>
      </div>
    </div>
  </section>

  <section id="roadmap" class="section">
    <div class="container">
      <span class="eyebrow">Roadmap</span>
      <h2>進捗とこれから</h2>
      <div class="grid grid-3">
        {site.roadmap.map((r) => (
          <div class="card">
            <div class="pill">{r.period}</div>
            <h3 style="margin:10px 0 8px">{r.title}</h3>
            <ul>
              {r.items.map((i) => (<li>• {i}</li>))}
            </ul>
          </div>
        ))}
      </div>
    </div>
  </section>

  <section id="team" class="section">
    <div class="container">
      <span class="eyebrow">Team</span>
      <h2>コアメンバー</h2>
      <div class="grid grid-3">
        {site.team.map((m) => (
          <div class="card" style="text-align:center">
            <div style="width:64px;height:64px;border-radius:50%;margin:0 auto 10px;background: radial-gradient(circle at 30% 30%, #fff, var(--accent) 40%, transparent 70%); box-shadow:0 0 0 1px var(--outline)"></div>
            <strong>{m.name}</strong>
            <div class="muted">{m.role}</div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <section id="faq" class="section">
    <div class="container">
      <span class="eyebrow">FAQ</span>
      <h2>よくある質問</h2>
      {site.faq.map((f) => (
        <details>
          <summary>{f.q}</summary>
          <div class="muted">{f.a}</div>
        </details>
      ))}
    </div>
  </section>

  <section id="cta" class="section">
    <div class="container card" style="display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap: wrap;">
      <div>
        <h2 style="margin:0">{site.cta.primary}</h2>
        <div class="muted">IEO開始後、対応取引所のIEOページからご参加ください。</div>
      </div>
      <div style="display:flex; gap:12px; flex-wrap:wrap">
        <a class="btn primary" href="#ieo">IEO詳細へ</a>
        <a class="btn ghost" href={site.links.whitepaper}>ホワイトペーパー</a>
      </div>
    </div>
    <div class="container" style="margin-top:14px;">
      <small class="muted">{site.legal.disclaimer}</small>
    </div>
  </section>

</BaseLayout>
